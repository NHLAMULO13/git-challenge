/**! @preserve
 * 
 * Geniuslink Link Converter v1.0.0

   How to use this snippet:

   1. Add the snippet to your website:

      <script src="https://cdn.geni.us/snippet.js" defer><\/script>

   2. Call the convertLinks() function to convert links to Genius Links (after the snippet script tag):
      
      <script src="https://cdn.geni.us/snippet.js" defer></script>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
          var tsid = 5;
          Genius.snippet.convertLinks(tsid, true, '//buy.geni.us');
        });
      </script>

      ** OR **
      to attach an onclick handler to the link
      (if you want to redirect to the link when the user clicks on it):
      
      <script src="https://cdn.geni.us/snippet.js" defer></script>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
          var tsid = 5;
          Genius.snippet.addOnClickRedirect(tsid, true);
        });
      </script>

    3. To only target links for specific programs, you can call them like this:

      <script src="https://cdn.geni.us/snippet.js" defer></script>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
          var tsid = 5;
          Genius.amazon.convertLinks(tsid, true, '//buy.geni.us');
          Genius.google.convertLinks(tsid, '//buy.geni.us');
        });
      </script>

    4. To ignore links, you can add `georiot-ignore="true"` to the link:

      <a href="https://www.amazon.com" georiot-ignore="true">Amazon</a>
      
 */
if(void 0===Georiot)//The shield to avoid running the code twice
{var Georiot=Georiot||{},Genius=Genius||{};
/*******************Compatibility section *****************************/
/*This functions are floating here 
    for compatability purposes with the amazon 
    link engine plugin Once a new version of the plugin is out kill them with fire*/
function convertToGeoRiotLinks(tsid){var numberOfLinks=document.links.length,currentLinkIndex=0;for(currentLinkIndex=0;currentLinkIndex<numberOfLinks;currentLinkIndex++){var currentLink=document.links[currentLinkIndex],linkType;"amazon"==getLinkType(currentLink.href)&&(currentLink.href="http://target.georiot.com/Proxy.ashx?TSID="+tsid+"&GR_URL="+encodeURIComponent(currentLink.href)+"&oldendpoint=true")}}function extractItunesLinkFromAffiliateUrl(currentLink,linkType){if(currentLink.href.indexOf("?")>0){var arrParams,arrURLParams=currentLink.href.split("?")[1].split("&"),arrParamNames=new Array(arrURLParams.length),arrParamValues=new Array(arrURLParams.length),i=0;for(i=0;i<arrURLParams.length;i++){var sParam=arrURLParams[i].split("=");arrParamNames[i]=sParam[0],""!=sParam[1]?arrParamValues[i]=sParam[1]:arrParamValues[i]=""}}return""}
/* Returns link type: unknown, amazon
     */function getLinkType(currentLinkHref){var amazonRegex=/\.amazon\./,amazonLocalRegex=/local\.amazon\./;return currentLinkHref.indexOf("target.georiot.com")>0||currentLinkHref.indexOf("geni.us")>0?"unknown":amazonRegex.test(currentLinkHref)&&!amazonLocalRegex.test(currentLinkHref)?"amazon":"unknown"}Georiot.getLinkType=function(currentLinkHref){var appleRegex=/(?:itunes|search|books|music|apps|podcasts)\.apple\.com\/.*/i,tradeDoublerRegex=/clk[uk]*\.tradedoubler\.com\S*\?\S*url=[https%3A%2F%2F|http%3A%2F%2F]*\itunes\.apple\.com/i,linkshareRegexApple=/click\.linksynergy\.com\S*?\S*RD_PARM1=[https%3A%2F%2F|https%253A%252F%252F|http%253A%252F%252F|http%3A%2F%2F]*\itunes\.apple\.com/i,dgmPerfRegex=/t.dgm-au.c\S+\?+\S*u=[https%3A%2F%2F|http%3A%2F%2F|https%253A%252F%252F|http%253A%252F%252F]*\itunes\.apple\.com/i,amazonRegex=/^(?!amazon\.jobs)(^amazon\.|^amzn\.com|^amzn\.co\.uk|^amzn\.to|^smile.amazon\.)/,amazonLocalRegex=/local\.amazon\./,googleRegex=/^google\.prf\.hn|^play\.google\.com/,linkshareRegexMSFT=/click\.linksynergy\.com\S*?\S*murl=\S*microsoft\.com.*/i,microsoftStoreRegex=/clk.*\.tradedoubler\.com\S*\?\S*url=[https%3A%2F%2F|http%3A%2F%2F].*microsoftstore\.com/i,microsoftStoreRegex2=/microsoftstore.com/i,microsoftOnlineRegex=/clk.*\.tradedoubler\.com\S*\?\S*url=[https%3A%2F%2F|http%3A%2F%2F].*microsoft\.com.*/i,microsoftOnlineRegex2=/microsoft.com\/.*(store|p)\/.*/i;if(currentLinkHref.indexOf("target.georiot.com")>0||currentLinkHref.indexOf("geni.us")>0)return"unknown";var cleanprep=currentLinkHref.toLowerCase().replace("https://","").replace("http://","").replace("www.","");return appleRegex.test(currentLinkHref)?"apple":tradeDoublerRegex.test(currentLinkHref)?"tradedoubler":linkshareRegexApple.test(currentLinkHref)?"linkshareApple":dgmPerfRegex.test(currentLinkHref)?"dgmperf":amazonRegex.test(cleanprep)&&!amazonLocalRegex.test(cleanprep)?"amazon":googleRegex.test(cleanprep)?"google":linkshareRegexMSFT.test(cleanprep)?"linkshareMSFT":microsoftStoreRegex.test(cleanprep)||microsoftStoreRegex2.test(cleanprep)||microsoftOnlineRegex.test(cleanprep)||microsoftOnlineRegex2.test(cleanprep)?"microsoft":"unknown"},Georiot.extractLinkFromAffiliateUrl=function(currentLink,linkType){if(currentLink.href.indexOf("?")>0)for(var arrParams,arrUrlParams=currentLink.href.split("?")[1].split("&"),arrParamNames=new Array(arrUrlParams.length),arrParamValues=new Array(arrUrlParams.length),i=0;i<arrUrlParams.length;i++){var sParam=arrUrlParams[i].split("=");if(arrParamNames[i]=sParam[0],""!==sParam[1]){if(arrParamValues[i]=sParam[1],"tradedoubler"===linkType&&"url"===arrParamNames[i])return arrParamValues[i];if("linkshareApple"===linkType&&"RD_PARM1"===arrParamNames[i])return arrParamValues[i];if("dgmperf"===linkType&&"u"===arrParamNames[i])return arrParamValues[i];if("linkshareMSFT"===linkType&&"murl"===arrParamNames[i])return arrParamValues[i]}else arrParamValues[i]=""}return""},Georiot.baseDomain="//buy.geni.us",Georiot.createOnClickFunction=function(linkOnPage,destLink){return linkOnPage.setAttribute("data-geniuslink",destLink),function(){return"_blank"===linkOnPage.target?window.open(destLink,"_blank"):window.location.assign(destLink),!1}},Georiot.baseConvertLinks=function(tsid,types,passDtb,domain,useOnClick,specialProcessingForLinkTypes){if(!Georiot.utility.isThrive()){
//Optional params javascript
void 0===domain&&(domain=Georiot.baseDomain),!1===passDtb||!0===passDtb||(passDtb=!1),!1===useOnClick||!0===useOnClick||(useOnClick=!1)
/**
         * Ends optional params
         */;for(var numberOfLinks=document.links.length,currentLinkIndex=0;currentLinkIndex<numberOfLinks;currentLinkIndex++){var currentLink=document.links[currentLinkIndex];if(currentLink.hasAttribute("georiot-ignore")&&"true"===currentLink.getAttribute("georiot-ignore"));else{var linkType=Georiot.getLinkType(currentLink.href);if(!(types.indexOf(linkType)>-1))continue;var linkToUse=currentLink.href;if(void 0!==specialProcessingForLinkTypes&&(linkToUse=specialProcessingForLinkTypes(currentLink,linkType)),""!==linkToUse){var proxylink=domain+"/Proxy.ashx?TSID="+tsid+"&GR_URL="+encodeURIComponent(linkToUse);passDtb&&(proxylink+="&dtb=1"),useOnClick?
//This is a bit tricky cuz we basically need 
//to generate one function for each link
currentLink.onclick=Georiot.createOnClickFunction(currentLink,proxylink):currentLink.href=proxylink}}}}},Georiot.utility={scriptIncluded:function(src){for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++)if(scripts[i].getAttribute("src")===src)return!0;return!1},isThrive:function(){return window.location.search.indexOf("tve=true")>-1}},Georiot.amazon={convertLinks:function(tsid,passDtb,domain){Georiot.amazon.convertToGeoRiotLinks(tsid,passDtb,domain)},convertToGeoRiotLinks:function(tsid,passDtb,domain){Georiot.baseConvertLinks(tsid,["amazon"],passDtb,domain,!1)},addOnClickRedirect:function(tsid,passDtb,domain){Georiot.baseConvertLinks(tsid,["amazon"],passDtb,domain,!0)}},Georiot.snippet={convertLinks:function(tsid,passDtb,domain){Georiot.snippet.convertToGeoRiotLinks(tsid,passDtb,domain)},convertToGeoRiotLinks:function(tsid,passDtb,domain){Georiot.baseConvertLinks(tsid,["apple","amazon","linkshareApple","linkshareMSFT","tradedoubler","dgmperf"],passDtb,domain,!1,function(currentLink,linkType){return"linkshareApple"===linkType||"tradedoubler"===linkType||"dgmperf"===linkType||"linkshareMSFT"===linkType?decodeURIComponent(Georiot.extractLinkFromAffiliateUrl(currentLink,linkType)):currentLink})},addOnClickRedirect:function(tsid,passDtb,domain){Georiot.baseConvertLinks(tsid,["apple","amazon","linkshareApple","tradedoubler","dgmperf"],passDtb,domain,!0,function(currentLink,linkType){return"linkshareApple"===linkType||"tradedoubler"===linkType||"dgmperf"===linkType?decodeURIComponent(Georiot.extractLinkFromAffiliateUrl(currentLink,linkType)):currentLink})}},Georiot.itunes={convertLinks:function(tsid,passDtb,domain){Georiot.itunes.convertToGeoRiotLinks(tsid,passDtb,domain)},convertToGeoRiotLinks:function(tsid,passDtb,domain){
//We only have passDtb for apple letting the parameter passed because we published it like that by mistake once.
//That parameter does not do anything but don't wanna break people since param order matters.
Georiot.baseConvertLinks(tsid,["apple"],!1,domain,!1)},addOnClickRedirect:function(tsid,passDtb,domain){Georiot.baseConvertLinks(tsid,["apple"],!1,domain,!0)}},Georiot.google={convertLinks:function(tsid,domain){Georiot.google.convertToGeoRiotLinks(tsid,domain)},convertToGeoRiotLinks:function(tsid,domain){Georiot.baseConvertLinks(tsid,["google"],!1,domain,!1)},addOnClickRedirect:function(tsid,domain){Georiot.baseConvertLinks(tsid,["google"],!1,domain,!0)}},Georiot.microsoft={convertLinks:function(tsid,domain,useOnClick){Georiot.microsoft.convertToGeoRiotLinks(tsid,domain,useOnClick)},convertToGeoRiotLinks:function(tsid,domain){Georiot.baseConvertLinks(tsid,["microsoft","linkshareMSFT"],!1,domain,!1,function(currentLink,linkType){return"linkshareMSFT"===linkType?decodeURIComponent(Georiot.extractLinkFromAffiliateUrl(currentLink,linkType)):currentLink})},addOnClickRedirect:function(tsid,domain){Georiot.baseConvertLinks(tsid,["microsoft"],!1,domain,!0,function(currentLink,linkType){return"linkshareMSFT"===linkType?decodeURIComponent(Georiot.extractLinkFromAffiliateUrl(currentLink,linkType)):currentLink})}},Genius.amazon=Georiot.amazon,Genius.snippet=Georiot.snippet,Genius.itunes=Georiot.itunes,Genius.google=Georiot.google,Genius.microsoft=Georiot.microsoft}